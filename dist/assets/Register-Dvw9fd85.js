import{r as x,a7 as S,J as k,N,K as F,a2 as C,a8 as P,j as e,a4 as R,y as B}from"./index-BzLzT3j-.js";import{H as T}from"./Heading-CLU1H8lp.js";import{z as n,u as q,t as H,I as d}from"./index-CVCHQwwo.js";import{R as D,C as I}from"./Row-C34yTrzI.js";import{F as L,S as U}from"./Spinner-brn0HqLf.js";const z=n.object({firstName:n.string().min(1,{message:"First name is required"}),lastName:n.string().min(1,{message:"Last name is required"}),email:n.string().min(1,{message:"email is required"}).email(),password:n.string().min(8,{message:"Password must be at least 8 characters longs"}).regex(/.*[!@#$%^&*()_+{}|[\]\\:";'<>?,./].*/,{message:"Password should contain at least 1 special character"}),confirmPassword:n.string().min(1,{message:"Confirm password is required"})}).refine(i=>i.password===i.confirmPassword,{message:"Password does not match",path:["confirmPassword"]}),O=()=>{const[i,a]=x.useState("idle"),[o,s]=x.useState(null);return{emailAvilabilityStatus:i,enteredEmail:o,checkEmailAvailability:async l=>{s(l),a("checking");try{(await S.get(`/users?email=${l}`)).data.length?a("notAvailable"):a("available")}catch{a("failed")}},resetCheckEmailAvailability:()=>{a("idle"),s(null)}}},_=()=>{const i=k(),a=N(),{loading:o,error:s,accessToken:r}=F(c=>c.auth),{register:g,handleSubmit:l,getFieldState:t,trigger:w,formState:{errors:u}}=q({mode:"onBlur",resolver:H(z)}),p=async c=>{const{firstName:b,lastName:v,email:y,password:A}=c;a(P({firstName:b,lastName:v,email:y,password:A})).unwrap().then(()=>{i("/login?message=account_created")})},{emailAvilabilityStatus:h,enteredEmail:m,checkEmailAvailability:f,resetCheckEmailAvailability:E}=O(),j=async c=>{await w("email");const b=c.target.value,{isDirty:v,invalid:y}=t("email");v&&!y&&m!==b&&f(b),v&&y&&m&&E()};return x.useEffect(()=>()=>{a(C())},[a]),{loading:o,error:s,accessToken:r,formErrors:u,emailAvilabilityStatus:h,emailOnBlurHandler:j,submitForm:p,register:g,handleSubmit:l}},Q=()=>{var u,p,h,m,f;const{loading:i,error:a,accessToken:o,formErrors:s,emailAvilabilityStatus:r,emailOnBlurHandler:g,submitForm:l,register:t,handleSubmit:w}=_();return o?e.jsx(R,{to:"/"}):e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"User Registration"}),e.jsx(D,{children:e.jsx(I,{md:{span:6,offset:3},children:e.jsxs(L,{onSubmit:w(l),children:[e.jsx(d,{label:"First Name",name:"firstName",register:t,error:(u=s.firstName)==null?void 0:u.message}),e.jsx(d,{label:"Last Name",name:"lastName",register:t,error:(p=s.lastName)==null?void 0:p.message}),e.jsx(d,{label:"email",name:"email",register:t,onBlur:g,error:(h=s.email)!=null&&h.message?s.email.message:r==="notAvailable"?"This email is already in use .":r==="failed"?"Error from the server .":"",formText:r==="checking"?"Checking email availability ...":"",success:r==="available"?"Email available":"",disabled:r==="checking"}),e.jsx(d,{label:"password",name:"password",type:"password",register:t,error:(m=s.password)==null?void 0:m.message}),e.jsx(d,{label:"confirm Password",name:"confirmPassword",type:"password",register:t,error:(f=s.confirmPassword)==null?void 0:f.message}),e.jsx(B,{variant:"info",type:"submit",style:{color:"white"},disabled:r==="checking"?!0:i==="pending",children:i==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(U,{animation:"border",size:"sm"})," Loading..."]}):"Submit"}),a&&e.jsx("p",{style:{color:"#DC3545",marginTop:"10px"},children:a})]})})})]})};export{Q as default};
