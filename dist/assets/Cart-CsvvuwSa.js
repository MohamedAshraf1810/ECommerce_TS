import{N as b,r as l,j as e,a9 as u,y as f,aa as L,ab as P,K as y,ac as k,ad as v,ae as F,af as I,ag as O,ah as C}from"./index-BzLzT3j-.js";import{C as w,L as E}from"./CartItem-CkOC8e2T.js";import{H as A}from"./Heading-CLU1H8lp.js";import{S as T}from"./Spinner-brn0HqLf.js";import"./Row-C34yTrzI.js";const B="_container_1f5l5_1",S={container:B},q=({products:s,userAccessToken:o})=>{const r=b(),[n,a]=l.useState(!1),[c,i]=l.useState(!1),[p,m]=l.useState(null),d=s.reduce((h,g)=>{const H=g.price,j=g.quantity;return j&&typeof j=="number"?h+H*j:h},0),t=()=>{a(!n),m(null)},x=()=>{i(!0),r(L(d)).unwrap().then(()=>{r(P()),a(!1)}).catch(h=>{m(h)}).finally(()=>{i(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(u,{show:n,onHide:t,backdrop:"static",children:[e.jsx(u.Header,{closeButton:!0,children:e.jsx(u.Title,{children:"Place Order"})}),e.jsxs(u.Body,{children:["You are about to place order with : ",d.toFixed(2)," EGP",!c&&p&&e.jsx("p",{style:{marginTop:"10px"},children:p})]}),e.jsxs(u.Footer,{children:[e.jsx(f,{variant:"secondary",onClick:t,children:"Close"}),e.jsx(f,{variant:"info",style:{color:"white"},onClick:x,children:c?e.jsxs(e.Fragment,{children:[e.jsx(T,{animation:"border",size:"sm"})," Loading..."]}):"Confirm"})]})]}),e.jsxs("div",{className:S.container,children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:[d.toFixed(2)," EGP"]})]}),o&&e.jsxs("div",{className:S.container,children:[e.jsx("span",{}),e.jsx("span",{children:e.jsx(f,{variant:"info",style:{color:"white"},onClick:t,children:"Place Order"})})]})]})},G=({products:s,changeQuantityHandler:o,removeItemHandler:r})=>{const n=s.map(a=>e.jsx(w,{...a,changeQuantityHandler:o,removeItemHandler:r},a.id));return e.jsx("div",{children:n})},M=()=>{const s=b(),{items:o,productsFullInfo:r,loading:n,error:a}=y(t=>t.cart),c=y(t=>t.auth.accessToken),i=y(t=>t.orders.loading),p=r.map(t=>({...t,quantity:o[t.id]})),m=l.useCallback((t,x)=>{s(k({id:t,quantity:x}))},[s]),d=l.useCallback(t=>{s(v(t))},[s]);return l.useEffect(()=>{const t=s(F());return()=>{t.abort(),s(I()),s(O())}},[s]),{products:p,loading:n,error:a,userAccessToken:c,placeOrderLoadStatus:i,removeItemHandler:d,changeQuantityHandler:m}},z=()=>{const{products:s,loading:o,error:r,userAccessToken:n,placeOrderLoadStatus:a,removeItemHandler:c,changeQuantityHandler:i}=M();return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Shopping Cart"}),e.jsx(E,{status:o,error:r,type:"cart",children:s.length?e.jsxs(e.Fragment,{children:[e.jsx(G,{products:s,changeQuantityHandler:i,removeItemHandler:c}),e.jsx(q,{products:s,userAccessToken:n})]}):a==="succeeded"?e.jsx(C,{type:"success",message:"Order Placed successfully",LoopStatus:!1}):e.jsx(C,{type:"empty",message:"Your cart is empty"})})]})};export{z as default};
